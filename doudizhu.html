<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>é¬¥åœ°ä¸» å·”å³°ç«¶æŠ€å¤§å¸«ç‰ˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Cinzel+Decorative:wght@700&family=IM+Fell+English:ital@0;1&display=swap" rel="stylesheet">

<style>
:root {
    --gold: #f0c040;
    --gold-light: #fde68a;
    --gold-dark: #b8860b;
    --red: #c0392b;
    --red-deep: #7b1a1a;
    --red-bright: #ef4444;
    --green-felt: #1a4a2e;
    --green-dark: #0f2d1c;
    --black-card: #1a1a2e;
    --white-card: #fdfaf5;
    --table-bg: #16391f;
    --card-font: 'IM Fell English', 'Noto Serif TC', serif;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Noto Serif TC', serif;
    background: var(--green-dark);
    color: #f0e6c8;
    text-align: center;
    overflow-x: hidden;
    padding-bottom: 90px;
    min-height: 100vh;
    background-image:
        radial-gradient(ellipse at 20% 20%, rgba(139,69,19,0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(139,69,19,0.15) 0%, transparent 50%),
        repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(255,255,255,0.012) 40px, rgba(255,255,255,0.012) 41px),
        repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(255,255,255,0.012) 40px, rgba(255,255,255,0.012) 41px);
}

.tension-bg {
    background-color: #300000 !important;
    animation: alarm 1.5s infinite;
}
@keyframes alarm { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.15) saturate(1.3); } }

/* ===== é ‚éƒ¨é¢æ¿ ===== */
.stats-panel {
    background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(20,10,0,0.8));
    border-radius: 0 0 16px 16px;
    padding: 10px 16px 12px;
    margin: 0 auto 6px;
    width: 100%;
    max-width: 640px;
    border: 1px solid rgba(240,192,64,0.3);
    border-top: none;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5), inset 0 1px 0 rgba(240,192,64,0.2);
}

.rank-badge {
    font-size: 13px;
    color: var(--gold);
    font-weight: 700;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(240,192,64,0.2);
}

.win-streak {
    background: linear-gradient(to right, #f97316, #dc2626);
    padding: 3px 12px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 900;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 8px rgba(249,115,22,0.4);
    animation: pulse-streak 1.5s infinite;
}
@keyframes pulse-streak { 0%, 100% { box-shadow: 0 2px 8px rgba(249,115,22,0.4); } 50% { box-shadow: 0 2px 20px rgba(249,115,22,0.8); } }

.daily-quest-banner {
    font-size: 12px;
    color: #c084fc;
    font-weight: 700;
    margin-bottom: 8px;
    text-shadow: 0 0 10px rgba(192,132,252,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    letter-spacing: 0.3px;
}
.quest-done { color: #4ade80 !important; text-shadow: 0 0 10px rgba(74,222,128,0.6) !important; }

#scoreDisplay {
    display: flex;
    justify-content: space-around;
    font-size: 12px;
    gap: 4px;
}

.score-item {
    background: rgba(0,0,0,0.3);
    border-radius: 8px;
    padding: 4px 10px;
    flex: 1;
    border: 1px solid rgba(240,192,64,0.15);
}

.score-label { color: #a8956a; font-size: 10px; margin-bottom: 2px; }
.score-value { font-weight: 900; font-size: 14px; }

/* ===== æ¨™é¡Œ ===== */
.game-title {
    font-family: 'Cinzel Decorative', serif;
    font-size: 16px;
    color: var(--gold);
    text-shadow: 0 0 20px rgba(240,192,64,0.6), 2px 2px 0 rgba(0,0,0,0.8);
    margin: 8px 0 4px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
    letter-spacing: 1px;
}

.rules-btn {
    background: transparent;
    color: var(--gold);
    padding: 2px 10px;
    font-size: 10px;
    border-radius: 6px;
    border: 1px solid var(--gold);
    cursor: pointer;
    font-family: 'Noto Serif TC', serif;
    transition: all 0.2s;
}
.rules-btn:hover { background: var(--gold); color: #1a0a00; }

#info {
    margin: 4px auto;
    font-size: 14px;
    font-weight: 700;
    color: var(--gold-light);
    height: 22px;
    text-shadow: 0 0 12px rgba(253,230,138,0.5);
    letter-spacing: 0.3px;
}

/* ===== åº•ç‰Œå€ ===== */
.hole-cards-wrapper {
    margin: 8px auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.hole-cards-label {
    font-size: 11px;
    color: rgba(240,192,64,0.6);
    letter-spacing: 1px;
    text-transform: uppercase;
}

.hole-cards {
    display: flex;
    justify-content: center;
    gap: 8px;
    height: 70px;
}

/* ===== å€æ•¸å¾½ç«  ===== */
.multiplier-badge {
    position: fixed;
    top: 140px;
    right: 12px;
    background: linear-gradient(135deg, #dc2626, #7f1d1d);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 900;
    z-index: 60;
    border: 1px solid rgba(255,100,100,0.5);
    box-shadow: 0 2px 12px rgba(220,38,38,0.5);
    animation: pulse-badge 1s infinite;
    display: none;
}
@keyframes pulse-badge { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.06); } }

/* å€æ•¸çˆ†ç‚¸æ•ˆæœ */
.multiplier-burst {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 72px;
    font-weight: 900;
    color: var(--gold);
    text-shadow: 0 0 30px rgba(240,192,64,0.9);
    z-index: 500;
    pointer-events: none;
    animation: burst-anim 1.2s ease-out forwards;
}
@keyframes burst-anim {
    0% { opacity: 1; transform: translate(-50%, -50%) scale(0.3); }
    40% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
    100% { opacity: 0; transform: translate(-50%, -70%) scale(0.8); }
}

/* ===== å°æ‰‹ HUD ===== */
.opponents-hud {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 92%;
    max-width: 640px;
    margin: 6px auto;
    gap: 8px;
}

.table-center-icon {
    font-size: 28px;
    opacity: 0.3;
    flex: 0 0 auto;
}

.opp-box {
    background: linear-gradient(135deg, rgba(0,0,0,0.5), rgba(10,20,10,0.6));
    border: 1px solid rgba(100,120,100,0.4);
    border-radius: 14px;
    padding: 10px 12px;
    flex: 1;
    position: relative;
    /* ã€å„ªåŒ–ã€‘åŠ å…¥ transition è®“é ­åƒè·³å‹•ä¹Ÿèƒ½å¹³æ»‘éæ¸¡ */
    transition: all 0.3s, transform 0.25s cubic-bezier(0.34,1.56,0.64,1);
    overflow: hidden;
}

.opp-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: transparent;
    transition: background 0.3s;
}

.opp-box.active {
    border-color: var(--gold);
    box-shadow: 0 0 20px rgba(240,192,64,0.3);
    /* ã€å„ªåŒ–ã€‘å°æ‰‹è¼ªåˆ°æ™‚è¼•å¾®è·³å‹•ï¼Œå¼·åŒ–ã€Œæ€è€ƒä¸­ã€è¦–è¦ºåé¥‹ */
    transform: translateY(-4px);
}
.opp-box.active::before {
    background: linear-gradient(to right, transparent, var(--gold), transparent);
}

.opp-avatar { font-size: 26px; margin-bottom: 3px; }
.opp-name { font-size: 11px; color: #a0a0a0; margin-bottom: 4px; letter-spacing: 0.3px; }
.opp-count {
    font-size: 22px;
    font-weight: 900;
    color: var(--white-card);
    font-variant-numeric: tabular-nums;
}
.opp-count-label { font-size: 10px; color: #888; }

.landlord-icon {
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 22px;
    display: none;
    animation: spin-in 0.4s ease;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8));
}
.is-landlord .landlord-icon { display: block; animation: pulse 1s infinite; }

.thinking-dots {
    display: none;
    gap: 3px;
    justify-content: center;
    margin-top: 3px;
}
.opp-box.active .thinking-dots { display: flex; }
.thinking-dots span {
    width: 5px; height: 5px;
    background: var(--gold);
    border-radius: 50%;
    animation: dot-bounce 1.2s infinite;
}
.thinking-dots span:nth-child(2) { animation-delay: 0.2s; }
.thinking-dots span:nth-child(3) { animation-delay: 0.4s; }
@keyframes dot-bounce { 0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; } 40% { transform: scale(1); opacity: 1; } }

/* ===== éŠæˆ²æ¡Œé¢ ===== */
#table {
    min-height: 120px;
    margin: 6px auto;
    background:
        radial-gradient(ellipse at center, rgba(26,74,46,0.8), rgba(10,35,20,0.9)),
        repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.01) 10px, rgba(255,255,255,0.01) 11px);
    border-radius: 20px;
    width: 92%;
    max-width: 640px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: visible;
    padding: 15px 10px;
    flex-wrap: wrap;
    gap: 0;
    border: 1px solid rgba(240,192,64,0.15);
    box-shadow: inset 0 0 30px rgba(0,0,0,0.4), 0 0 0 4px rgba(0,0,0,0.3);
    position: relative;
}

.table-empty-hint {
    color: rgba(240,192,64,0.25);
    font-size: 13px;
    letter-spacing: 2px;
    position: absolute;
    pointer-events: none;
}

/* ===== ç©å®¶è³‡è¨Šåˆ— ===== */
.player-info-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 92%;
    max-width: 640px;
    margin: 0 auto 2px;
    padding: 6px 14px;
    background: linear-gradient(135deg, rgba(240,192,64,0.08), rgba(0,0,0,0.3));
    border-radius: 12px 12px 0 0;
    border: 1px solid rgba(240,192,64,0.2);
    border-bottom: none;
}
.player-avatar-wrap {
    display: flex;
    align-items: center;
    gap: 8px;
}
.player-avatar { font-size: 22px; }
.player-label { font-size: 13px; font-weight: 900; color: var(--gold); letter-spacing: 0.5px; }
.player-role-badge {
    font-size: 11px;
    padding: 2px 10px;
    border-radius: 10px;
    font-weight: 900;
    opacity: 0;
    transition: opacity 0.4s;
}
.player-role-badge.landlord { background: linear-gradient(135deg,#f0c040,#b8860b); color:#1a0a00; opacity:1; }
.player-role-badge.farmer { background: rgba(74,222,128,0.2); color:#4ade80; border:1px solid rgba(74,222,128,0.4); opacity:1; }
.player-card-count { font-size: 12px; color: #a0a0a0; }
.player-card-count span { color: var(--gold-light); font-weight: 900; }

/* ===== æ‰‹ç‰Œåº•æ¿ ===== */
.hand-wrapper {
    width: 92%;
    max-width: 640px;
    margin: 0 auto;
    /* å…è¨±æ©«å‘æ²å‹•ï¼Œè®“æ¡Œæ©Ÿä¹Ÿèƒ½çœ‹åˆ°å…¨éƒ¨ç‰Œ */
    overflow-x: auto;
    overflow-y: visible;
    background: linear-gradient(to bottom, rgba(0,0,0,0.35), rgba(0,0,0,0.2));
    border-radius: 0 0 14px 14px;
    border: 1px solid rgba(240,192,64,0.2);
    border-top: 2px solid rgba(240,192,64,0.35);
    /* æ¡Œæ©Ÿé¡¯ç¤ºç´°æ²è»¸ï¼Œæ‰‹æ©Ÿéš±è— */
    scrollbar-width: thin;
    scrollbar-color: rgba(240,192,64,0.35) transparent;
}
.hand-wrapper::-webkit-scrollbar { height: 4px; }
.hand-wrapper::-webkit-scrollbar-track { background: transparent; }
.hand-wrapper::-webkit-scrollbar-thumb {
    background: rgba(240,192,64,0.35);
    border-radius: 2px;
}

.hand {
    display: flex;
    justify-content: flex-start;
    /* ä¸åœ¨ .hand å±¤è¨­ overflowï¼Œäº¤çµ¦ .hand-wrapper çµ±ä¸€ç®¡ç† */
    overflow-x: visible;
    overflow-y: visible;
    padding: 30px 16px 16px 16px;
    /* ç¢ºä¿å…§å®¹ä¸æ›è¡Œ */
    width: max-content;
    min-width: 100%;
}
.hand::-webkit-scrollbar { display: none; }

/* ===== ç‰Œé¢æ¨£å¼ ===== */
.card {
    flex: 0 0 auto;
    width: 60px;
    height: 88px;
    background: var(--white-card);
    border-radius: 10px;
    margin: 0 -13px;
    border: 1px solid #e0d8cc;
    position: relative;
    transition: transform 0.18s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.18s ease;
    overflow: hidden;
    color: #111;
    user-select: none;
    cursor: pointer;
    box-shadow: -3px 0 10px rgba(0,0,0,0.5), 0 2px 4px rgba(0,0,0,0.3);
}
.card:first-child { margin-left: 0; }
.card:hover { transform: translateY(-14px) rotate(-1deg); z-index: 10; box-shadow: -3px 0 10px rgba(0,0,0,0.3), 0 14px 24px rgba(0,0,0,0.5); }
.card.selected {
    transform: translateY(-24px) scale(1.04);
    border: 2px solid var(--gold);
    box-shadow: 0 12px 28px rgba(0,0,0,0.7), 0 0 0 1px var(--gold-dark), 0 0 20px rgba(240,192,64,0.3);
    z-index: 100 !important;
}

/* ç‰Œé¢å…‰æ¾¤ */
.card::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, transparent 50%);
    pointer-events: none;
    border-radius: 9px;
}

/* ===== ã€å„ªåŒ–ã€‘ç‰ŒèƒŒç´‹è·¯ - SVG è±æ ¼ç´‹ ===== */
.card-back-pattern {
    position: absolute;
    inset: 0;
    border-radius: 8px;
    background-color: #1a3a7a;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14'%3E%3Cpath d='M7 0L14 7L7 14L0 7Z' fill='none' stroke='rgba(255,255,255,0.1)' stroke-width='0.8'/%3E%3C/svg%3E");
    background-size: 14px 14px;
    border: 2px solid rgba(255,255,255,0.18);
    overflow: hidden;
}
/* ç‰ŒèƒŒä¸­å¤®å°ç«  */
.card-back-pattern::before {
    content: 'â™ ';
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 28px;
    color: rgba(255,255,255,0.12);
    line-height: 1;
}
/* ç‰ŒèƒŒå…§æ¡† */
.card-back-pattern::after {
    content: '';
    position: absolute;
    inset: 5px;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 5px;
}

/* ===== ã€å„ªåŒ–ã€‘è§’è½ä½¿ç”¨ IM Fell English å­—é«” ===== */
.corner {
    position: absolute;
    font-family: var(--card-font);
    font-size: 13px;
    font-weight: 900;
    z-index: 5;
    line-height: 1.1;
    text-align: center;
    font-style: italic;
}
.corner-suit { font-size: 10px; }
.top-left { top: 4px; left: 5px; }
.bottom-right { bottom: 4px; right: 5px; transform: rotate(180deg); }

.suit-heart, .suit-diamond { color: #cc1111; }
.suit-spade, .suit-club { color: #111; }

/* è‡‰ç‰Œä¸­å¤®åœ–æ¡ˆ */
.face-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -54%);
    font-size: 28px;
    z-index: 2;
    line-height: 1;
}
.face-suit-stamp {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    z-index: 2;
    opacity: 0.5;
}

.full-cover { position: absolute; width: 100%; height: 100%; top: 0; left: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; box-sizing: border-box; }
.joker-bg-red {
    background: linear-gradient(145deg, #dc2626, #7f1d1d);
    color: #fff;
    border: 2px solid var(--gold);
}
.joker-bg-black {
    background: linear-gradient(145deg, #374151, #111827);
    color: #fff;
    border: 2px solid #6b7280;
}
.joker-icon { font-size: 20px; margin-bottom: 1px; }
.joker-text { writing-mode: vertical-rl; font-size: 17px; font-weight: 900; letter-spacing: 3px; text-shadow: 2px 2px 4px rgba(0,0,0,0.6); }

/* åº•ç‰Œä¸­çš„å°ç‰Œ */
.hole-card {
    width: 44px; height: 66px;
    background: var(--white-card);
    border-radius: 8px;
    border: 1px solid #ddd;
    box-shadow: 0 3px 10px rgba(0,0,0,0.4);
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; font-weight: 900;
    position: relative; overflow: hidden;
    animation: flip-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}
.hole-card.hidden {
    background-color: transparent;
    border: none;
}
.hole-card.hidden .card-back-pattern {
    border-radius: 7px;
}

@keyframes flip-in {
    from { transform: rotateY(90deg) scale(0.8); opacity: 0; }
    to { transform: rotateY(0deg) scale(1); opacity: 1; }
}
.hole-card:nth-child(2) { animation-delay: 0.1s; }
.hole-card:nth-child(3) { animation-delay: 0.2s; }

/* ===== æ§åˆ¶å™¨ ===== */
.controls {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    background: linear-gradient(to top, rgba(5,15,8,0.97), rgba(10,25,12,0.93));
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    padding: 10px 0 14px;
    box-shadow: 0 -1px 0 rgba(240,192,64,0.25), 0 -8px 32px rgba(0,0,0,0.7);
    z-index: 50;
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
}

button {
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 900;
    border-radius: 24px;
    border: none;
    cursor: pointer;
    transition: all 0.18s cubic-bezier(0.34, 1.56, 0.64, 1);
    font-family: 'Noto Serif TC', serif;
    letter-spacing: 0.5px;
    /* ã€å„ªåŒ–ã€‘ç¢ºä¿æŒ‰éˆ•ä¸å› æ›è¡Œé€ æˆç‰ˆå‹æ··äº‚ */
    white-space: nowrap;
    min-width: 68px;
}
button:active { transform: scale(0.95) !important; }

.btn-play {
    background: linear-gradient(135deg, var(--gold), #d4a017);
    color: #1a0a00;
    box-shadow: 0 4px 15px rgba(240,192,64,0.4);
    padding: 10px 32px;
    font-size: 15px;
    border: 1px solid rgba(255,220,100,0.5);
}
.btn-play:hover { box-shadow: 0 6px 25px rgba(240,192,64,0.6); transform: translateY(-2px); }

.btn-pass {
    background: rgba(80,80,80,0.6);
    color: #ccc;
    border: 1px solid rgba(150,150,150,0.3);
}
.btn-pass:hover { background: rgba(100,100,100,0.7); }

.btn-bid {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    color: white;
    border: 1px solid rgba(96,165,250,0.4);
    box-shadow: 0 3px 10px rgba(37,99,235,0.4);
}
.btn-bid:hover { box-shadow: 0 5px 18px rgba(37,99,235,0.6); transform: translateY(-2px); }

.btn-hint {
    background: linear-gradient(135deg, #7c3aed, #6d28d9);
    color: white;
    border: 1px solid rgba(167,139,250,0.4);
    box-shadow: 0 3px 10px rgba(124,58,237,0.4);
}
.btn-hint:hover { box-shadow: 0 5px 18px rgba(124,58,237,0.6); transform: translateY(-2px); }

/* ===== å½ˆçª— ===== */
.modal-overlay {
    position: fixed; top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(6px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background: linear-gradient(145deg, #1c1008, #2a1810);
    color: #f0e6c8;
    padding: 28px 24px;
    border-radius: 20px;
    width: 88%;
    max-width: 420px;
    max-height: 85vh;
    overflow-y: auto;
    border: 1px solid rgba(240,192,64,0.4);
    box-shadow: 0 0 60px rgba(240,192,64,0.15), 0 20px 60px rgba(0,0,0,0.8);
    animation: modal-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes modal-in { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

.modal-title-win { color: var(--gold); font-size: 26px; font-weight: 900; margin-bottom: 16px; text-shadow: 0 0 20px rgba(240,192,64,0.5); }
.modal-title-lose { color: #f87171; font-size: 24px; font-weight: 900; margin-bottom: 16px; }

.result-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    border-radius: 10px;
    margin-bottom: 6px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
}
.result-row.player-row {
    background: rgba(240,192,64,0.1);
    border-color: rgba(240,192,64,0.3);
}
.result-change { font-weight: 900; font-size: 16px; }

.btn-restart {
    background: linear-gradient(135deg, var(--gold), #d4a017);
    color: #1a0a00;
    width: 100%;
    padding: 13px;
    margin-top: 16px;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 900;
    box-shadow: 0 4px 15px rgba(240,192,64,0.3);
    transition: all 0.2s;
}
.btn-restart:hover { box-shadow: 0 6px 25px rgba(240,192,64,0.5); }
.btn-reset {
    background: rgba(80,80,80,0.4);
    color: #aaa;
    border: 1px solid rgba(150,150,150,0.2);
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border-radius: 10px;
    font-size: 13px;
}

.rules-text { text-align: left; font-size: 13px; color: #c8b88a; line-height: 1.9; }
.rules-text b { color: var(--gold); }
.rules-section { margin-bottom: 10px; padding: 10px 12px; background: rgba(255,255,255,0.04); border-radius: 10px; border-left: 3px solid var(--gold); }

/* ===== å«ç‰ŒæŒ‰éˆ•é€²å ´å‹•ç•« ===== */
@keyframes slide-up-btn {
    from { opacity: 0; transform: translateY(28px) scale(0.9); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
}
.btn-bid-anim { animation: slide-up-btn 0.35s cubic-bezier(0.34,1.56,0.64,1) both; }
.btn-bid-anim:nth-child(2) { animation-delay: 0.07s; }
.btn-bid-anim:nth-child(3) { animation-delay: 0.14s; }
.btn-bid-anim:nth-child(4) { animation-delay: 0.21s; }

/* å«ç‰Œéšæ®µåº•æ¬„æç¤ºæ¨™èª */
.bid-label {
    width: 100%;
    text-align: center;
    font-size: 11px;
    color: rgba(240,192,64,0.5);
    letter-spacing: 1px;
    margin-bottom: 2px;
}

/* ===== åœ°ä¸»å®£å‘Šè¦†è“‹å±¤ ===== */
.landlord-announce {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 900;
    pointer-events: none;
    animation: announce-anim 1.8s ease-out forwards;
}
@keyframes announce-anim {
    0%   { opacity: 0; }
    15%  { opacity: 1; }
    70%  { opacity: 1; }
    100% { opacity: 0; }
}
.landlord-announce-text {
    font-family: 'Cinzel Decorative', serif;
    font-size: 42px;
    color: var(--gold);
    text-shadow: 0 0 40px rgba(240,192,64,0.9), 0 0 80px rgba(240,192,64,0.4), 4px 4px 0 rgba(0,0,0,0.8);
    letter-spacing: 4px;
    animation: text-scale-in 0.5s cubic-bezier(0.34,1.56,0.64,1) both;
}
@keyframes text-scale-in {
    from { transform: scale(0.4) rotate(-8deg); opacity: 0; }
    to   { transform: scale(1) rotate(0deg); opacity: 1; }
}
.landlord-announce-sub {
    font-size: 18px;
    color: rgba(255,255,255,0.85);
    margin-top: 10px;
    letter-spacing: 2px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.8);
}
.landlord-announce-bg {
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at center, rgba(0,0,0,0.75) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
}
@keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.12); } }
@keyframes shake { 0%, 100% { transform: translate(0) rotate(0deg); } 10%, 30%, 50%, 70%, 90% { transform: translate(-5px,-2px) rotate(-1deg); } 20%, 40%, 60%, 80% { transform: translate(5px,2px) rotate(1deg); } }
.shake-screen { animation: shake 0.45s cubic-bezier(0.36, 0.07, 0.19, 0.97) both; }

/* å½©å¸¶ */
#confetti-container { position: fixed; top:0; left:0; width:100vw; height:100vh; pointer-events:none; z-index:999; display:none; overflow:hidden; }
.confetti-piece {
    position: absolute; top: -20px;
    width: 10px; height: 16px;
    animation: confetti-fall linear forwards;
    border-radius: 3px;
    opacity: 0.9;
}
@keyframes confetti-fall { to { transform: translateY(110vh) rotate(720deg); } }

/* å‹åˆ©å…‰æ•ˆ */
.win-glow {
    position: fixed; top:0; left:0; right:0; bottom:0;
    background: radial-gradient(ellipse at center, rgba(240,192,64,0.15), transparent 70%);
    pointer-events: none;
    z-index: 998;
    animation: win-glow-anim 2s ease-out forwards;
}
@keyframes win-glow-anim { 0% { opacity: 1; } 100% { opacity: 0; } }

/* ===== ç‰Œå‹å…¬å‘Šçˆ†ç‚¸ç‰¹æ•ˆ ===== */
.type-burst-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    pointer-events: none;
    z-index: 800;
    animation: type-burst-fade 1.4s ease-out forwards;
}
@keyframes type-burst-fade {
    0%   { opacity: 0; }
    12%  { opacity: 1; }
    65%  { opacity: 1; }
    100% { opacity: 0; }
}
.type-burst-text {
    font-family: 'Noto Serif TC', serif;
    font-size: 52px;
    font-weight: 900;
    color: #fff;
    letter-spacing: 6px;
    text-shadow:
        0 0 20px rgba(240,192,64,1),
        0 0 60px rgba(240,192,64,0.6),
        3px 3px 0 rgba(0,0,0,0.8);
    animation: type-burst-scale 0.45s cubic-bezier(0.34,1.6,0.64,1) both;
    white-space: nowrap;
}
.type-burst-text.bomb {
    color: var(--gold);
    font-size: 58px;
    text-shadow:
        0 0 30px rgba(220,38,38,1),
        0 0 80px rgba(220,38,38,0.7),
        3px 3px 0 rgba(0,0,0,0.9);
}
@keyframes type-burst-scale {
    from { transform: scale(0.2) rotate(-6deg); opacity:0; }
    to   { transform: scale(1)   rotate(0deg);  opacity:1; }
}
.type-burst-who {
    font-size: 15px;
    color: rgba(255,255,255,0.75);
    letter-spacing: 3px;
    margin-top: 8px;
    text-shadow: 0 2px 6px rgba(0,0,0,0.8);
}
.type-burst-bg {
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at center, rgba(0,0,0,0.45) 0%, transparent 65%);
}

/* ===== å°æ‰‹ç‰Œæ•¸å±æ€¥é«˜äº® ===== */
.opp-count.danger  { color: #f87171 !important; animation: pulse 0.8s infinite; }
.opp-count.warning { color: #fb923c !important; }

/* ===== ç™¼ç‰Œå…¥å ´å‹•ç•« ===== */
@keyframes card-deal {
    from { opacity:0; transform: translateY(30px) rotate(5deg) scale(0.88); }
    to   { opacity:1; transform: translateY(0) rotate(0deg) scale(1); }
}
.card-deal-anim { animation: card-deal 0.28s cubic-bezier(0.34,1.2,0.64,1) both; }

/* ç‰ˆæ¬Š */
.copyright { font-size: 10px; color: rgba(240,192,64,0.2); text-align: center; padding: 8px 0 4px; letter-spacing: 1px; }

/* â”€â”€ å¹³æ¿ï¼ˆ768px ä»¥ä¸‹ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 768px) {
    .stats-panel { border-radius: 0 0 12px 12px; }
    .game-title { font-size: 14px; }
    #table { min-height: 110px; }
    .type-burst-text { font-size: 44px; }
    .type-burst-text.bomb { font-size: 52px; }
}

/* â”€â”€ æ‰‹æ©Ÿï¼ˆ600px ä»¥ä¸‹ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 600px) {
    body { padding-bottom: 80px; }
    /* ã€å„ªåŒ–ã€‘è§¸æ§è£ç½®å¢åŠ é–“è·é¿å…èª¤è§¸ */
    .card { width: 46px; height: 70px; margin: 0 -8px; }
    .card:hover { transform: translateY(-10px) rotate(-1deg); }
    .card.selected { transform: translateY(-20px) scale(1.04); }
    .joker-text { font-size: 13px; } .joker-icon { font-size: 15px; }
    button { padding: 8px 12px; font-size: 12px; }
    .btn-play { padding: 8px 22px; font-size: 13px; }
    .game-title { font-size: 13px; gap: 8px; }
    .opp-count { font-size: 18px; }
    .opp-avatar { font-size: 22px; }
    .opp-name { font-size: 10px; }
    .player-info-bar { width: 92%; padding: 5px 10px; }
    .player-label { font-size: 12px; }
    .player-card-count { font-size: 11px; }
    .player-role-badge { font-size: 10px; padding: 2px 8px; }
    .hand-wrapper { width: 92%; scrollbar-width: none; }
    .hand-wrapper::-webkit-scrollbar { display: none; }
    .hand { padding: 26px 12px 14px 12px; }
    #table { min-height: 95px; padding: 10px 8px; border-radius: 14px; }
    .hole-cards { height: 60px; gap: 6px; }
    .hole-card { width: 38px; height: 56px; }
    .type-burst-text { font-size: 36px; letter-spacing: 3px; }
    .type-burst-text.bomb { font-size: 42px; }
    .type-burst-who { font-size: 13px; }
    .landlord-announce-text { font-size: 28px; letter-spacing: 2px; }
    .score-item { padding: 3px 6px; }
    .score-value { font-size: 12px; }
    .score-label { font-size: 9px; }
    .daily-quest-banner { font-size: 11px; }
}
</style>
</head>
<body>

<div id="confetti-container"></div>

<div class="stats-panel">
    <div class="rank-badge">
        <span id="playerRank">ğŸ–ï¸ è¼‰å…¥ä¸­...</span>
        <span id="winStreakBadge" class="win-streak" style="display:none;">ğŸ”¥ 0 é€£å‹</span>
    </div>
    <div id="dailyQuestBanner" class="daily-quest-banner">ğŸ¯ ä»Šæ—¥ä»»å‹™ï¼šè¼‰å…¥ä¸­...</div>
    <div id="scoreDisplay"></div>
</div>

<div class="game-title">
    ğŸƒ é¬¥åœ°ä¸» å·”å³°å¤§å¸«ç‰ˆ
    <button class="rules-btn" onclick="document.getElementById('rulesModal').style.display='flex'">è¦å‰‡</button>
</div>
<div id="info">ç³»çµ±æº–å‚™ä¸­...</div>

<div class="hole-cards-wrapper">
    <div class="hole-cards-label">åº• ç‰Œ</div>
    <div class="hole-cards" id="holeCardsArea"></div>
</div>

<div id="multiplierBadge" class="multiplier-badge">x1</div>

<div id="opponentsHUD" class="opponents-hud"></div>
<div id="table"><span class="table-empty-hint" id="tableEmptyHint">å‡ºç‰Œå€</span></div>

<div class="player-info-bar" id="playerInfoBar">
    <div class="player-avatar-wrap">
        <div class="player-avatar">ğŸ­</div>
        <div>
            <div class="player-label">ä½ </div>
        </div>
    </div>
    <div id="playerRoleBadge" class="player-role-badge"></div>
    <div class="player-card-count">æ‰‹ç‰Œ <span id="playerCardCount">0</span> å¼µ</div>
</div>
<div class="hand-wrapper">
    <div id="player" class="hand"></div>
</div>

<div class="copyright">&copy; 2026 LinWei's Doudizhu Â· Enhanced Edition v2</div>

<div class="controls" id="controlPanel">
    <button class="btn-bid" onclick="playerBid(1)" id="btnBid1" style="display:none;">å« 1 åˆ†</button>
    <button class="btn-bid" onclick="playerBid(2)" id="btnBid2" style="display:none;">å« 2 åˆ†</button>
    <button class="btn-bid" onclick="playerBid(3)" id="btnBid3" style="display:none;">å« 3 åˆ†</button>
    <button class="btn-pass" onclick="playerBid(0)" id="btnNoBid" style="display:none;">ä¸å«</button>
    
    <button class="btn-hint" onclick="hint()" id="btnHint" style="display:none;">ğŸ’¡ æç¤º</button>
    <button class="btn-play" onclick="play()" id="btnPlay" style="display:none;">å‡º ç‰Œ</button>
    <button class="btn-pass" onclick="pass()" id="btnPass" style="display:none;">ä¸ å‡º</button>
</div>

<!-- çµç®—å½ˆçª— -->
<div id="scoreModal" class="modal-overlay">
    <div class="modal-content">
        <div id="modalTitle" class="modal-title-win">å±€æ•¸çµç®—</div>
        <div id="modalScores" style="margin-top:12px; line-height:1.8;"></div>
        <button class="btn-restart" onclick="location.reload()">â–¶ ç¹¼çºŒä¸‹ä¸€å±€</button>
        <button class="btn-reset" onclick="localStorage.removeItem('doudizhu_stats'); location.reload();">é‡ç½®æ‰€æœ‰åˆ†æ•¸</button>
    </div>
</div>

<!-- è¦å‰‡å½ˆçª— -->
<div id="rulesModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-title-win" style="font-size:20px;">ğŸ“œ éŠæˆ²è¦å‰‡</div>
        <div class="rules-text">
            <div class="rules-section"><b>ğŸ’¡ æ™ºèƒ½æç¤ºï¼š</b>é»æ“Šæç¤ºæŒ‰éˆ•ï¼Œç³»çµ±ä¾ç‰Œå‹å¼·åº¦æ’åºå¾ŒæŒ‘é¸æœ€ä½³ç‰Œçµ„ã€‚è‹¥ç„¡ç‰Œå¯å£“ï¼Œé¡¯ç¤ºã€Œè¦ä¸èµ·ã€ã€‚</div>
            <div class="rules-section"><b>ğŸ¯ æ¯æ—¥ä»»å‹™ï¼š</b>æ¯å¤©æŒ‡å®šä¸€ç¨®ç‰Œå‹ï¼ˆå¦‚é£›æ©Ÿï¼‰ã€‚æ‰“å‡ºä¸¦ç²å‹ï¼Œå‹åˆ†é¡å¤–<b>ç¿»å€</b>ï¼</div>
            <div class="rules-section"><b>ğŸ–ï¸ è·ç¨±ç³»çµ±ï¼š</b>ç´¯ç©ç©åˆ†æ™‰å‡éšç´šã€‚é€£å‹3å ´ä»¥ä¸Šï¼Œå‹åˆ†åŠ æˆ20%ã€‚</div>
            <div class="rules-section"><b>ğŸ¤– å”ä½œAIï¼š</b>è¾²æ°‘å…·å‚™é…åˆéšŠå‹ã€è®“ç‰Œèˆ‡é˜²å®ˆé‚è¼¯ï¼›åœ°ä¸»ç€•å±æ™‚ç´…å…‰è­¦å ±äº®èµ·ã€‚</div>
            <div class="rules-section"><b>ğŸ’¥ ç¿»å€æ©Ÿåˆ¶ï¼š</b>ç‚¸å½ˆ/ç«ç®­ã€æ˜¥å¤©/åæ˜¥å¤©ï¼Œå€æ•¸å‡ä¹˜ä»¥2ã€‚</div>
        </div>
        <button class="btn-restart" onclick="document.getElementById('rulesModal').style.display='none'">æº–å‚™è¿æˆ° ï¼</button>
    </div>
</div>

<script>
/* ===== éŸ³æ•ˆ ===== */
const sndPlayCard = new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3');
const sndBomb = new Audio('https://assets.mixkit.co/active_storage/sfx/1690/1690-preview.mp3');
sndPlayCard.volume = 0.5; sndBomb.volume = 0.8;
function playSound(snd) { snd.currentTime = 0; snd.play().catch(e => {}); }

/* ===== åŸºç¤è¨­å®š ===== */
const suits = ["â™£", "â™¦", "â™¥", "â™ "];
const ranks = ["3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A", "2"];
const power = { "3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,"10":10,"J":11,"Q":12,"K":13,"A":14,"2":15,"BJ":16,"RJ":17 };

// AIè§’è‰²è¨­å®š
const aiNames = ["", { name: "é¾å“¥", avatar: "ğŸ‰" }, { name: "ç‹ç‹¸å¦¹", avatar: "ğŸ¦Š" }];
const playerAvatar = "ğŸ­";

let deck = [], players = [[], [], []], holeCards = [];
let current = 0, selected = [], last = null, consecutivePasses = 0, lastPlayer = -1;
let landlord = -1, baseScore = 0, gameMultiplier = 1;
let currentBid = 0, bidQueue = [], bidIndex = 0;
let landlordPlayCount = 0, farmerPlayCount = 0;

/* ===== çµ±è¨ˆèˆ‡ä»»å‹™ ===== */
/* ã€Bugä¿®å¾©ã€‘localStorage è®€å–åŠ ä¸Š try-catch é˜²æ­¢èˆŠç‰ˆè³‡æ–™æ ¼å¼éŒ¯èª¤é€ æˆå´©æ½° */
let stats;
try {
    stats = JSON.parse(localStorage.getItem("doudizhu_stats")) || { totalScores:[0,0,0], currentWinStreak:0, maxWinStreak:0 };
    if (!Array.isArray(stats.totalScores) || stats.totalScores.length !== 3) throw new Error("bad format");
} catch(e) {
    stats = { totalScores:[0,0,0], currentWinStreak:0, maxWinStreak:0 };
    localStorage.removeItem("doudizhu_stats");
}

let dailyQuestTarget = "", questAchievedThisRound = false;
const questPool = ["é †å­","é€£å°","ä¸‰å¸¶ä¸€å–®","ä¸‰å¸¶ä¸€å°","ç´”é£›æ©Ÿ","é£›æ©Ÿå¸¶å–®ç‰Œ","é£›æ©Ÿå¸¶å°å­","å››å¸¶äºŒå–®","å››å¸¶äºŒå°"];

function initDailyQuest() {
    let today = new Date().toDateString();
    let saved;
    try { saved = JSON.parse(localStorage.getItem("doudizhu_daily_quest")); } catch(e) { saved = null; }
    if (saved && saved.date === today) dailyQuestTarget = saved.target;
    else { dailyQuestTarget = questPool[Math.floor(Math.random() * questPool.length)]; localStorage.setItem("doudizhu_daily_quest", JSON.stringify({date: today, target: dailyQuestTarget})); }
    document.getElementById("dailyQuestBanner").innerHTML = `ğŸ¯ ä»Šæ—¥ä»»å‹™ï¼šæ‰“å‡ºã€${dailyQuestTarget}ã€‘å‹åˆ† x2`;
}

function getRankName(score) {
    if (score < 0) return "ğŸšï¸ è²§è¾²";
    if (score < 50) return "ğŸŒ¾ ä¸­è¾²";
    if (score < 200) return "ğŸ¡ å¯Œè¾²";
    if (score < 500) return "ğŸ‘‘ åœ°ä¸»";
    return "ğŸ’° è³­ç¥";
}

function updateStatsUI() {
    document.getElementById("playerRank").innerText = `ğŸ–ï¸ ${getRankName(stats.totalScores[0])}`;
    if (stats.currentWinStreak >= 2) {
        let b = document.getElementById("winStreakBadge");
        b.style.display = "inline-block";
        b.innerText = `ğŸ”¥ ${stats.currentWinStreak} é€£å‹`;
    } else { document.getElementById("winStreakBadge").style.display = "none"; }

    let html = "";
    const labels = ["ä½ ", "é¾å“¥", "ç‹ç‹¸å¦¹"];
    for (let i = 0; i < 3; i++) {
        let s = stats.totalScores[i];
        let cls = i === 0 ? "player-score" : "";
        html += `<div class="score-item ${cls}">
            <div class="score-label">${labels[i]}</div>
            <div class="score-value" style="color:${s>=0?'#4ade80':'#f87171'}">${s>=0?'+'+s:s}</div>
        </div>`;
    }
    document.getElementById("scoreDisplay").innerHTML = html;
}

function updateMultiplierUI() {
    let badge = document.getElementById("multiplierBadge");
    if (gameMultiplier > 1) {
        badge.style.display = "inline-block";
        badge.innerText = `å€æ•¸ Ã—${gameMultiplier}`;
    }
}

function showMultiplierBurst(text) {
    let el = document.createElement('div');
    el.className = 'multiplier-burst';
    el.textContent = text;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1200);
}

function checkTension() {
    if (landlord !== -1 && players[landlord].length > 0 && players[landlord].length <= 3)
        document.body.classList.add("tension-bg");
    else
        document.body.classList.remove("tension-bg");
}

/* ===== æ¸²æŸ“ ===== */
function renderHoleCards(reveal = false) {
    let html = "";
    if (!reveal) {
        /* ã€å„ªåŒ–ã€‘ä½¿ç”¨æ–°çš„ SVG è±æ ¼ç´‹ç‰ŒèƒŒ */
        for (let i = 0; i < 3; i++) html += `<div class="hole-card hidden"><div class="card-back-pattern"></div></div>`;
    } else {
        holeCards.forEach(c => {
            if (c.isJoker) {
                let isRed = c.rank === "RJ";
                html += `<div class="hole-card ${isRed ? 'joker-bg-red' : 'joker-bg-black'}" style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
                    <span style="font-size:16px">${isRed?'ğŸ‘‘':'ğŸƒ'}</span>
                    <span style="font-size:11px;font-weight:900;color:#fff;">${isRed?'å¤§ç‹':'å°ç‹'}</span>
                </div>`;
            } else {
                let suitClass = (c.suit==='â™¥'||c.suit==='â™¦') ? 'suit-heart' : 'suit-spade';
                html += `<div class="hole-card">
                    <div style="display:flex;flex-direction:column;align-items:center;">
                        <span class="${suitClass}" style="font-family:var(--card-font);font-weight:900;font-size:13px;">${c.rank}</span>
                        <span class="${suitClass}" style="font-size:14px;">${c.suit}</span>
                    </div>
                </div>`;
            }
        });
    }
    document.getElementById("holeCardsArea").innerHTML = html;
}

function renderOpponents() {
    let hud = document.getElementById("opponentsHUD");
    hud.innerHTML = "";
    for (let i = 1; i <= 2; i++) {
        let isActive = current === i ? "active" : "";
        let isLandlordClass = landlord === i ? "is-landlord" : "";
        let ai = aiNames[i];
        let cnt = players[i].length;
        let cntClass = cnt <= 1 ? "danger" : cnt <= 3 ? "warning" : "";
        hud.innerHTML += `
        <div class="opp-box ${isActive} ${isLandlordClass}">
            <div class="landlord-icon">ğŸ§‘â€ğŸŒ¾</div>
            <div class="opp-avatar">${ai.avatar}</div>
            <div class="opp-name">${ai.name}</div>
            <div class="opp-count ${cntClass}">${cnt}<span class="opp-count-label"> å¼µ</span></div>
            <div class="thinking-dots"><span></span><span></span><span></span></div>
        </div>`;
    }
    checkTension();
}

/* ===== ã€å„ªåŒ–ã€‘buildCardHTML ä½¿ç”¨ IM Fell English å­—é«” ===== */
function buildCardHTML(card, compact=false) {
    // â”€â”€ å¤§å°ç‹ â”€â”€
    if (card.isJoker) {
        const isRed = card.rank === "RJ";
        return `<div class="full-cover ${isRed?'joker-bg-red':'joker-bg-black'}">
            <div class="joker-icon">${isRed?'ğŸ‘‘':'ğŸƒ'}</div>
            <div class="joker-text">${isRed?'å¤§<br>ç‹':'å°<br>ç‹'}</div>
        </div>`;
    }

    const isRed = card.suit === 'â™¥' || card.suit === 'â™¦';
    const clr = isRed ? '#cc1111' : '#111111';
    const s = card.suit;
    const r = card.rank;

    const cornerRank = compact ? '11px' : '13px';
    const cornerSuit = compact ? '10px' : '12px';
    const centerSize = compact ? '28px' : '40px';
    const aceSize    = compact ? '32px' : '46px';
    /* ã€å„ªåŒ–ã€‘è‡‰ç‰Œä½¿ç”¨ IM Fell English æ–œé«”ï¼Œæ›´æœ‰å¤å…¸æ’²å…‹æ„Ÿ */
    const faceSize   = compact ? '24px' : '30px';

    /* è§’è½ï¼šIM Fell English å­—é«” */
    const cornerInner = `<span style="font-size:${cornerRank};font-weight:900;color:${clr};font-family:'IM Fell English','Noto Serif TC',serif;font-style:italic;">${r}</span><span style="font-size:${cornerSuit};color:${clr};margin-left:1px;">${s}</span>`;

    const tlCorner = `<div style="
        position:absolute;top:4px;left:5px;
        display:flex;align-items:center;gap:0;
        z-index:5;line-height:1;user-select:none;
        ">${cornerInner}</div>`;

    const brCorner = `<div style="
        position:absolute;bottom:4px;right:5px;
        display:flex;align-items:center;gap:0;
        z-index:5;line-height:1;user-select:none;
        transform:rotate(180deg);
        ">${cornerInner}</div>`;

    // â”€â”€ è‡‰ç‰Œ J/Q/Kï¼šæ–œé«”å¤å…¸å­—æ¯ â”€â”€
    if (r === 'J' || r === 'Q' || r === 'K') {
        return `${tlCorner}
            <div style="
                position:absolute;top:50%;left:50%;
                transform:translate(-50%,-50%);
                font-family:'IM Fell English','Noto Serif TC',serif;
                font-size:${faceSize};font-weight:900;font-style:italic;
                line-height:1;color:${clr};z-index:2;
                user-select:none;">${r}</div>
            ${brCorner}`;
    }

    // â”€â”€ Aï¼šè¶…å¤§èŠ±è‰²å¡«æ»¿ä¸­å¤® â”€â”€
    if (r === 'A') {
        return `${tlCorner}
            <div style="
                position:absolute;top:50%;left:50%;
                transform:translate(-50%,-50%);
                font-size:${aceSize};line-height:1;
                color:${clr};z-index:2;user-select:none;">${s}</div>
            ${brCorner}`;
    }

    // â”€â”€ æ•¸å­—ç‰Œ 2ï½10ï¼šä¸­å¤®å–®ä¸€å¤§èŠ±è‰² â”€â”€
    return `${tlCorner}
        <div style="
            position:absolute;top:50%;left:50%;
            transform:translate(-50%,-50%);
            font-size:${centerSize};line-height:1;
            color:${clr};z-index:2;user-select:none;">${s}</div>
        ${brCorner}`;
}

function renderPlayer() {
    const isCompact = window.innerWidth <= 768;
    let area = document.getElementById("player");
    area.innerHTML = "";
    players[0].forEach((c, i) => {
        let div = document.createElement("div");
        div.className = "card card-deal-anim";
        div.style.animationDelay = (i * 0.03) + 's';
        if (selected.includes(i)) div.classList.add("selected");
        div.innerHTML = buildCardHTML(c, isCompact);
        div.onclick = () => toggle(i);
        area.appendChild(div);
    });
    let cc = document.getElementById("playerCardCount");
    if (cc) cc.textContent = players[0].length;
}

function showTypeBurst(typeName, whoName) {
    if (!typeName) return;
    const isBomb = typeName.includes('ç‚¸å½ˆ') || typeName.includes('ç«ç®­');
    let overlay = document.createElement('div');
    overlay.className = 'type-burst-overlay';
    overlay.innerHTML = `
        <div class="type-burst-bg"></div>
        <div class="type-burst-text${isBomb?' bomb':''}">${typeName}</div>
        <div class="type-burst-who">${whoName}</div>
    `;
    document.body.appendChild(overlay);
    setTimeout(() => overlay.remove(), 1450);
}

function renderTable(cards, typeName, whoName) {
    let t = document.getElementById("table");
    t.innerHTML = "";
    if (cards.length === 0) {
        let h = document.createElement('span');
        h.className = 'table-empty-hint';
        h.id = 'tableEmptyHint';
        if (current === 0 && landlord !== -1) h.textContent = 'âœ¨ ä½ ç²å¾—ç‰Œæ¬Šï¼Œè«‹è‡ªç”±å‡ºç‰Œ';
        else if (landlord !== -1) h.textContent = 'â³ ç­‰å¾…å‡ºç‰Œ...';
        else h.textContent = 'å‡ºç‰Œå€';
        t.appendChild(h);
    } else {
        showTypeBurst(typeName, whoName || '');
        cards.forEach((c, idx) => {
            let div = document.createElement("div");
            div.className = "card card-deal-anim";
            div.style.animationDelay = (idx * 0.04) + 's';
            div.innerHTML = buildCardHTML(c, false);
            t.appendChild(div);
        });
    }
}

function toggle(i) {
    if (selected.includes(i)) selected = selected.filter(x => x !== i);
    else selected.push(i);
    renderPlayerNoAnim();
}

function renderPlayerNoAnim() {
    const isCompact = window.innerWidth <= 768;
    let area = document.getElementById("player");
    area.innerHTML = "";
    players[0].forEach((c, i) => {
        let div = document.createElement("div");
        div.className = "card";
        if (selected.includes(i)) div.classList.add("selected");
        div.innerHTML = buildCardHTML(c, isCompact);
        div.onclick = () => toggle(i);
        area.appendChild(div);
    });
    let cc = document.getElementById("playerCardCount");
    if (cc) cc.textContent = players[0].length;
}

function updateInfo(msg) {
    let el = document.getElementById("info");
    el.textContent = msg;
    el.style.animation = 'none';
    el.offsetHeight;
    el.style.animation = 'fadeIn 0.3s ease';
}

/* ===== ç‰Œå‹è§£æ ===== */
function evaluate(cards) {
    if (!cards || cards.length === 0) return null;
    let sorted = [...cards].sort((a,b) => power[a.rank] - power[b.rank]);
    let counts = {}; sorted.forEach(c => counts[c.rank] = (counts[c.rank]||0)+1);
    let vals = Object.values(counts), keys = Object.keys(counts).sort((a,b) => power[a]-power[b]);
    let isSeq = (rankArr) => { if (rankArr.some(r => power[r] >= 15)) return false; for (let i=1;i<rankArr.length;i++){if(power[rankArr[i]]!==power[rankArr[i-1]]+1)return false;}return true; };

    if (cards.length===1) return {type:1,value:power[cards[0].rank],len:1,name:"å–®ç‰Œ"};
    if (cards.length===2) {
        if (cards[0].isJoker && cards[1].isJoker) return {type:99,value:999,len:2,name:"ç«ç®­(é›™ç‹)"};
        if (vals[0]===2) return {type:2,value:power[cards[0].rank],len:2,name:"å°å­"};
    }
    if (cards.length===3 && vals.includes(3)) return {type:3,value:power[cards[0].rank],len:3,name:"ä¸‰æ¢"};
    if (cards.length===4) {
        if (vals.includes(4)) return {type:10,value:power[sorted[0].rank],len:4,name:"ç‚¸å½ˆ(å››æ¢)"};
        if (vals.includes(3)) return {type:4,value:power[Object.keys(counts).find(k=>counts[k]===3)],len:4,name:"ä¸‰å¸¶ä¸€å–®"};
    }
    if (cards.length===5 && vals.includes(3) && vals.includes(2)) return {type:14,value:power[Object.keys(counts).find(k=>counts[k]===3)],len:5,name:"ä¸‰å¸¶ä¸€å°"};
    if (vals.includes(4)) {
        let fourRank = Object.keys(counts).find(k=>counts[k]===4);
        if (cards.length===6) return {type:6,value:power[fourRank],len:6,name:"å››å¸¶äºŒå–®"};
        if (cards.length===8){let pairCount=vals.filter(v=>v===2).length,fourCount=vals.filter(v=>v===4).length;if((fourCount===1&&pairCount===2)||fourCount===2)return {type:7,value:power[fourRank],len:8,name:"å››å¸¶äºŒå°"};}
    }
    if (cards.length>=5 && vals.every(v=>v===1) && isSeq(keys)) return {type:5,value:power[keys[keys.length-1]],len:cards.length,name:"é †å­"};
    if (cards.length>=6 && cards.length%2===0 && vals.every(v=>v===2) && isSeq(keys)) return {type:8,value:power[keys[keys.length-1]],len:cards.length,name:"é€£å°"};
    let threeRanks = Object.keys(counts).filter(k=>counts[k]>=3).sort((a,b)=>power[a]-power[b]);
    if (threeRanks.length>=2) {
        let validSeqs=[];
        for(let i=0;i<threeRanks.length;i++){let seq=[threeRanks[i]];for(let j=i+1;j<threeRanks.length;j++){if(power[threeRanks[j]]===power[seq[seq.length-1]]+1&&power[threeRanks[j]]<15){seq.push(threeRanks[j]);if(seq.length>=2)validSeqs.push([...seq]);}else break;}}
        validSeqs.sort((a,b)=>b.length-a.length);
        for(let seq of validSeqs){
            let planeLen=seq.length,planeValue=power[seq[seq.length-1]];
            if(cards.length===planeLen*3)return{type:11,value:planeValue,len:cards.length,name:"ç´”é£›æ©Ÿ"};
            if(cards.length===planeLen*4)return{type:12,value:planeValue,len:cards.length,name:"é£›æ©Ÿå¸¶å–®ç‰Œ"};
            if(cards.length===planeLen*5){let remainingVals=[];for(let k in counts){let c=counts[k];if(seq.includes(k))c-=3;if(c>0)remainingVals.push(c);}if(remainingVals.every(v=>v===2||v===4))return{type:13,value:planeValue,len:cards.length,name:"é£›æ©Ÿå¸¶å°å­"};}
        }
    }
    return null;
}

/* ===================================================
   â˜… AI æ ¸å¿ƒç³»çµ± v3 â€” å…¨é¢å‡ç´š
   â˜… æ–°å¢ï¼šç‰Œå †è¿½è¹¤ã€ä¿ç‰Œç­–ç•¥ã€é€²æ”»/é˜²å®ˆæ¨¡å¼åˆ‡æ›ã€
   â˜…       ç²¾æº–ç‚¸å½ˆæ™‚æ©Ÿã€æ‹†ç‰Œå£“åˆ¶ã€æ‰‹ç‰Œçµ„åˆè©•ä¼°
   =================================================== */

// å…¨å±€å·²å‡ºç‰Œè¿½è¹¤ï¼ˆæ¯å±€é‡ç½®ï¼‰
let playedCards = {};   // { rank: count }  è¨˜éŒ„æ•´å ´å·²æ‰“å‡ºçš„ç‰Œ
let playedBigCards = { "2":0, "A":0, "K":0, "BJ":0, "RJ":0 };

function recordPlayedCards(cards) {
    cards.forEach(c => {
        playedCards[c.rank] = (playedCards[c.rank] || 0) + 1;
        if (c.rank in playedBigCards) playedBigCards[c.rank]++;
    });
}

// åˆ¤æ–·æŸrankæ˜¯å¦å·²å…¨éƒ¨å‡ºå®Œï¼ˆç„¡äººå†æŒæœ‰ï¼‰
function rankExhausted(rank) {
    const total = (rank === "BJ" || rank === "RJ") ? 1 : 4;
    return (playedCards[rank] || 0) >= total;
}

// è¨ˆç®—æŸrankåœ¨å°æ‰‹æ‰‹ä¸­é‚„å‰©å¹¾å¼µï¼ˆéè‡ªå·±ï¼‰
function rankRemainingInOpponents(rank, selfIdx) {
    const total = (rank === "BJ" || rank === "RJ") ? 1 : 4;
    const played = playedCards[rank] || 0;
    const inHand = players[selfIdx].filter(c => c.rank === rank).length;
    return Math.max(0, total - played - inHand);
}

// è©•ä¼°ä¸€å¼µç‰Œçš„ã€Œå£“åˆ¶å®‰å…¨æ€§ã€ï¼šè‹¥å°æ‰‹å¹¾ä¹ä¸å¯èƒ½å£“éå‰‡é«˜
function isSafeToLead(rank) {
    if (rank === "RJ" || rank === "BJ") return true;
    if (rank === "2" && rankExhausted("RJ") && rankExhausted("BJ")) return true;
    // K ä»¥ä¸Šä¸”å°æ‰‹å‰©ç‰Œå‹è¼ƒå°‘æ™‚ä¹Ÿç®—å®‰å…¨
    if (power[rank] >= 13) return true;
    return false;
}

// â”€â”€â”€ æ ¸å¿ƒå‡ºç‰Œæœå°‹å‡½å¼ï¼ˆä¾› AI èˆ‡æç¤ºå…±ç”¨ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function findBestPlay(playerIdx, checkOnly=false) {
    const hand = players[playerIdx];
    if (!hand || hand.length === 0) return null;

    const counts = {}, cardsByRank = {};
    hand.forEach(c => {
        counts[c.rank] = (counts[c.rank]||0)+1;
        if (!cardsByRank[c.rank]) cardsByRank[c.rank] = [];
        cardsByRank[c.rank].push(c);
    });

    const getRanks = (min) => Object.keys(counts).filter(k => counts[k] >= min).sort((a,b) => power[a]-power[b]);
    const singles  = getRanks(1);
    const pairs    = getRanks(2);
    const triples  = getRanks(3);
    const bombs    = getRanks(4);
    const hasRocket = counts["BJ"] && counts["RJ"];

    const buildPlay = (rankList, cnt, extra=[]) => {
        let res = [];
        rankList.forEach(r => res.push(...cardsByRank[r].slice(0, cnt)));
        return res.concat(extra);
    };

    // â”€â”€ å°‹æ‰¾é€£é †å­ â”€â”€
    const findSeq = (arr, len, minVal=0) => {
        for (let i = 0; i <= arr.length - len; i++) {
            let seq = [arr[i]], ok = true;
            for (let j = 1; j < len; j++) {
                if (i+j < arr.length && power[arr[i+j]] === power[seq[j-1]]+1 && power[arr[i+j]] < 15)
                    seq.push(arr[i+j]);
                else { ok = false; break; }
            }
            if (ok && power[seq[seq.length-1]] > minVal) return seq;
        }
        return null;
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ã€è‡ªç”±å‡ºç‰Œæ¨¡å¼ã€‘å„ªå…ˆåº¦ï¼šé£›æ©Ÿå¸¶ > ç´”é£›æ©Ÿ > é€£å° > ä¸‰å¸¶å° > ä¸‰å¸¶å–® > å°å­ > å–®ç‰Œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (!last) {
        // 1. å˜—è©¦æœ€é•·é£›æ©Ÿå¸¶å–®
        for (let len = Math.min(triples.length, 4); len >= 2; len--) {
            let seq = findSeq(triples, len);
            if (seq) {
                let kickers = singles.filter(k => !seq.includes(k));
                if (kickers.length >= len) return buildPlay(seq, 3, buildPlay(kickers.slice(0, len), 1));
            }
        }
        // 2. ä¸‰å¸¶å°
        if (triples.length > 0) {
            let r = triples[0];
            let pairK = pairs.find(p => p !== r);
            if (pairK) return buildPlay([r], 3, buildPlay([pairK], 2));
        }
        // 3. ä¸‰å¸¶å–®
        if (triples.length > 0) {
            let r = triples[0];
            let singleK = singles.find(k => k !== r);
            if (singleK) return buildPlay([r], 3, buildPlay([singleK], 1));
            return buildPlay([r], 3);
        }
        // 4. é€£å°ï¼ˆæœ€å°é€£å°å„ªå…ˆå‡ºï¼Œçœä¸‹å¤§ç‰Œï¼‰
        for (let len = Math.min(Math.floor(pairs.length), 5); len >= 3; len--) {
            let seq = findSeq(pairs, len);
            if (seq) return buildPlay(seq, 2);
        }
        // 5. é †å­ï¼ˆ5å¼µèµ·ï¼‰
        let sSeq = findSeq(singles.filter(r => power[r] < 15), 5);
        if (sSeq) return buildPlay(sSeq, 1);
        // 6. å°å­ï¼ˆå‡ºæœ€å°çš„ï¼Œä¿ç•™å¤§å°å­ï¼‰
        if (pairs.length > 0) return buildPlay([pairs[0]], 2);
        // 7. å–®ç‰Œï¼ˆå‡ºæœ€å°ä¸”ä¸ç ´å£çµ„åˆçš„ç‰Œï¼‰
        // æ‰¾ä¸æˆå°/çµ„åˆçš„æœ€å°å–®ç‰Œ
        let loner = singles.find(r => counts[r] === 1 && power[r] < 11);
        if (loner) return buildPlay([loner], 1);
        return buildPlay([singles[0]], 1);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ã€å£“ç‰Œæ¨¡å¼ã€‘å¿…é ˆå£“éä¸Šå®¶
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const t = last.type, v = last.value, l = last.len;
    let playCards = null;

    if (t === 1) {
        // å–®ç‰Œï¼šå„ªå…ˆç”¨æœ€å°èƒ½å£“çš„ç‰Œï¼›è‹¥æ˜¯æ•£ç‰Œå‰‡ç›´æ¥å£“ï¼Œè‹¥æ˜¯çµ„åˆç”¨ç‰Œå‰‡è€ƒæ…®ä¿ç•™
        let valid = singles.find(r => power[r] > v);
        if (valid) {
            // è‹¥é€™å¼µæ˜¯çµ„åˆçš„é‡è¦ç‰Œï¼ˆå°å­/ä¸‰æ¢ï¼‰ï¼Œå˜—è©¦æ‰¾æ›´å°çš„æ•£ç‰Œ
            let betterSingle = singles.find(r => power[r] > v && counts[r] === 1);
            playCards = buildPlay([betterSingle || valid], 1);
        }
    }
    else if (t === 2) {
        let valid = pairs.find(r => power[r] > v);
        if (valid) playCards = buildPlay([valid], 2);
    }
    else if (t === 3) {
        let valid = triples.find(r => power[r] > v);
        if (valid) playCards = buildPlay([valid], 3);
    }
    else if (t === 4 || t === 14) {
        let validT = triples.find(r => power[r] > v);
        if (validT) {
            if (t === 4) {
                let kicker = singles.find(k => k !== validT);
                if (kicker) playCards = buildPlay([validT], 3, buildPlay([kicker], 1));
            } else {
                let pairK = pairs.find(p => p !== validT);
                if (pairK) playCards = buildPlay([validT], 3, buildPlay([pairK], 2));
            }
        }
    }
    else if (t === 5) { // é †å­
        let seq = findSeq(singles.filter(r => power[r] < 15), l, v);
        if (seq && seq.length === l) playCards = buildPlay(seq, 1);
    }
    else if (t === 8) { // é€£å°
        let pLen = l / 2;
        let seq = findSeq(pairs, pLen, v);
        if (seq && seq.length === pLen) playCards = buildPlay(seq, 2);
    }
    else if (t >= 11 && t <= 13) {
        let pLen = t===11 ? l/3 : (t===12 ? l/4 : l/5);
        let seq = findSeq(triples, pLen, v);
        if (seq) {
            let base = buildPlay(seq, 3);
            if (t === 11) {
                playCards = base;
            } else if (t === 12) {
                let avail = singles.filter(k => !seq.includes(k));
                if (avail.length >= pLen) playCards = base.concat(buildPlay(avail.slice(0, pLen), 1));
            } else if (t === 13) {
                let avail = pairs.filter(k => !seq.includes(k));
                if (avail.length >= pLen) playCards = base.concat(buildPlay(avail.slice(0, pLen), 2));
            }
        }
    }
    else if (t === 6 || t === 7) {
        let vBomb = bombs.find(r => power[r] > v);
        if (vBomb) {
            if (t === 6) {
                let avail = singles.filter(k => k !== vBomb);
                if (avail.length >= 2) playCards = buildPlay([vBomb], 4).concat(buildPlay(avail.slice(0, 2), 1));
            } else {
                let avail = pairs.filter(k => k !== vBomb);
                if (avail.length >= 2) playCards = buildPlay([vBomb], 4).concat(buildPlay(avail.slice(0, 2), 2));
            }
        }
    }
    else if (t === 10) {
        let valid = bombs.find(r => power[r] > v);
        if (valid) playCards = buildPlay([valid], 4);
    }

    // ç‚¸å½ˆå…œåº•ï¼ˆéç‚¸å½ˆ/ç«ç®­ç‰Œå‹æ‰èƒ½ç”¨ç‚¸å½ˆå£“ï¼‰
    if (!playCards && t !== 10 && t !== 99 && bombs.length > 0)
        playCards = buildPlay([bombs[0]], 4);
    if (!playCards && t !== 99 && hasRocket)
        playCards = buildPlay(["BJ", "RJ"], 1);

    return playCards;
}

// â”€â”€â”€ ã€æ–°å¢ã€‘æ‹†ç‰Œå£“åˆ¶ï¼šå¾å°å­/ä¸‰æ¢æ‹†å‡ºå–®ç‰Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function findSplitSingleOver(playerIdx, minVal) {
    const hand = players[playerIdx];
    const counts = {};
    hand.forEach(c => counts[c.rank] = (counts[c.rank]||0)+1);
    // æ‰¾å¯æ‹†ä¸”æ‹†å¾Œä»æœ‰å‰©çš„æœ€å°å–®ç‰Œï¼ˆå¦‚å°å­æ‹†ä¸€å¼µï¼‰
    const candidates = Object.keys(counts)
        .filter(r => power[r] > minVal && counts[r] >= 2 && power[r] < 16)
        .sort((a,b) => power[a]-power[b]);
    if (candidates.length === 0) return null;
    const r = candidates[0];
    return hand.filter(c => c.rank === r).slice(0, 1);
}

// â”€â”€â”€ æç¤ºåŠŸèƒ½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hint() {
    if (current !== 0) return;
    let bestCards = findBestPlay(0);
    if (bestCards) {
        selected = [];
        bestCards.forEach(c => { let idx = players[0].indexOf(c); if (idx !== -1) selected.push(idx); });
        renderPlayerNoAnim();
    } else { updateInfo("âš ï¸ è¦ä¸èµ·ï¼ˆç„¡ç‰Œå¯å£“ï¼‰"); }
}

function checkPlayerHasPlay() {
    if (current === 0 && last) {
        let hasPlay = findBestPlay(0, true);
        if (!hasPlay) updateInfo("âš ï¸ è¦ä¸èµ·ï¼Œæ²’æœ‰å¯å£“çš„ç‰Œ");
        else updateInfo("ğŸ¯ ä½ çš„å›åˆï¼Œè«‹å‡ºç‰Œï¼");
    } else if (current === 0) { updateInfo("âœ¨ ä½ çš„å›åˆï¼Œè‡ªç”±å‡ºç‰Œï¼"); }
}

/* ===== åŸ·è¡Œèˆ‡ AI ===== */
function executePlay(cards, r) {
    // è¨˜éŒ„å·²å‡ºç‰Œ
    recordPlayedCards(cards);

    if (r && r.name) {
        if (current === 0 && r.name === dailyQuestTarget && !questAchievedThisRound) {
            questAchievedThisRound = true;
            document.getElementById("dailyQuestBanner").innerHTML = `âœ… é”æˆä»»å‹™ï¼šæ‰“å‡ºã€${dailyQuestTarget}ã€‘`;
            document.getElementById("dailyQuestBanner").classList.add("quest-done");
        }
        if (r.type === 10 || r.type === 99) {
            playSound(sndBomb);
            document.body.classList.add("shake-screen");
            setTimeout(() => document.body.classList.remove("shake-screen"), 450);
            gameMultiplier *= 2; updateMultiplierUI();
            showMultiplierBurst(`ğŸ’¥ Ã—${gameMultiplier}`);
            updateInfo(`ğŸ’¥ æ‰“å‡º ${r.name}ï¼å€æ•¸ç¿»å€ Ã—${gameMultiplier}ï¼`);
        } else {
            playSound(sndPlayCard);
            let prefix = (r.type >= 11 && r.type <= 13) ? "âœˆï¸" : "ğŸƒ";
            let who = current === 0 ? "ä½ " : aiNames[current].name;
            updateInfo(`${prefix} ${who} æ‰“å‡º ${r.name}`);
        }
    }
    if (current === landlord) landlordPlayCount++; else farmerPlayCount++;
    players[current] = players[current].filter(c => !cards.includes(c));
    last = r; lastPlayer = current; consecutivePasses = 0;
    const whoName = current===0 ? 'ä½ å‡ºç‰Œ' : `${aiNames[current].avatar} ${aiNames[current].name}`;
    renderTable(cards, r ? r.name : '', whoName); renderOpponents();
    if (current === 0) { selected = []; renderPlayerNoAnim(); }
    if (players[current].length === 0) { setTimeout(() => endGame(current), 800); return; }
    current = (current + 1) % 3; renderOpponents();
    if (current !== 0) setTimeout(aiPlay, 1500); else checkPlayerHasPlay();
}

function executePass() {
    consecutivePasses++;
    if (consecutivePasses >= 2) {
        last = null; current = lastPlayer; consecutivePasses = 0;
        renderTable([], '', ''); renderOpponents();
        if (current === 0) { checkPlayerHasPlay(); } else setTimeout(aiPlay, 1200);
    } else {
        let who = current === 0 ? "ä½ " : aiNames[current].name;
        updateInfo(`ğŸ™… ${who} ä¸å‡º`);
        current = (current + 1) % 3; renderOpponents();
        if (current !== 0) setTimeout(aiPlay, 1200); else checkPlayerHasPlay();
    }
}

function play() {
    if (current !== 0 || selected.length === 0) return;
    let cards = selected.map(i => players[0][i]);
    let r = evaluate(cards);
    if (!r) { updateInfo("âš ï¸ ç‰Œå‹ä¸ç¬¦åˆè¦å‰‡ï¼"); return; }
    if (last) {
        if (r.type === 99) {}
        else if (r.type === 10 && last.type !== 10 && last.type !== 99) {}
        else if (r.type !== last.type) { updateInfo("âš ï¸ ç‰Œå‹å¿…é ˆèˆ‡ä¸Šå®¶ç›¸åŒï¼"); return; }
        else if (r.type === 5 && cards.length !== last.len) { updateInfo("âš ï¸ é †å­é•·åº¦ä¸ç¬¦ï¼"); return; }
        else if (r.value <= last.value) { updateInfo("âš ï¸ é»æ•¸å¿…é ˆå¤§æ–¼ä¸Šå®¶ï¼"); return; }
    }
    executePlay(cards, r);
}

function pass() {
    if (current !== 0) return;
    if (!last) { updateInfo("âš ï¸ æ“æœ‰ç‰Œæ¬Šæ™‚ä¸èƒ½ä¸å‡ºï¼"); return; }
    selected = []; renderPlayerNoAnim(); executePass();
}

/* ===================================================
   â˜… AI æ±ºç­–ä¸»å‡½å¼ v3
   â”€ åœ°ä¸»ï¼šé€²æ”»æ¨¡å¼ + å¤§ç‰Œå£“åˆ¶ + æ¸…ç‰Œè·¯ç·š
   â”€ è¾²æ°‘ï¼šå”ä½œè®“ç‰Œ + ç²¾æº–ç‚¸å½ˆæ™‚æ©Ÿ + æ‹†ç‰Œå£“åˆ¶
   =================================================== */
function aiPlay() {
    const isLandlord   = (current === landlord);
    const isTeammate   = !isLandlord;
    const myCount      = players[current].length;
    const teammate     = isTeammate ? [1,2].find(i => i !== current) : -1;
    const tmCount      = teammate >= 0 ? players[teammate].length : 99;
    const llCount      = players[landlord].length;

    // åˆ¤æ–·ä¸Šä¸€å‡ºç‰Œè€…è§’è‰²
    const isTeammateLast = isTeammate && lastPlayer !== landlord && lastPlayer !== -1 && lastPlayer !== current;
    const isLandlordLast = lastPlayer === landlord;

    // ç·Šæ€¥ç‹€æ…‹åˆ¤æ–·
    const llDanger   = llCount <= 2;   // åœ°ä¸»å¿«è´
    const tmDanger   = tmCount <= 2;   // è¾²æ°‘éšŠå‹å¿«è´
    const meDanger   = myCount <= 2;   // è‡ªå·±å¿«è´

    // è¨ˆç®—è‡ªå·±æ‰‹ç‰Œä¸­çš„ç‚¸å½ˆ
    const myCounts = {};
    players[current].forEach(c => myCounts[c.rank] = (myCounts[c.rank]||0)+1);
    const myBombs = Object.keys(myCounts).filter(k => myCounts[k] >= 4);
    const myHasRocket = myCounts["BJ"] && myCounts["RJ"];

    let playCards = null;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ã€åœ°ä¸»ç­–ç•¥ã€‘
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (isLandlord) {
        // è‡ªç”±å‡ºç‰Œï¼šä¸»å‹•é€²æ”»ï¼Œå‡ºçµ„åˆæœ€å¥½çš„ç‰Œå‹
        if (!last) {
            playCards = findBestPlay(current);
        } else {
            // è¾²æ°‘å¿«è´ â†’ ç«‹åˆ»ç‚¸å½ˆï¼ˆä¸ç®¡æ‰‹ç‰Œæ˜¯å¦å¤ å¤§ï¼‰
            if ((tmDanger || (players[1].length <= 3 && players[2].length <= 3)) && !last && myBombs.length > 0) {
                playCards = players[current].filter(c => c.rank === myBombs[0]);
            } else {
                playCards = findBestPlay(current);
                // ã€ä¿ç‰Œã€‘å£“å°æ‰‹å–®ç‰Œæ™‚ï¼Œè‹¥æœ‰æ•£ç‰Œå°±ç”¨æ•£ç‰Œï¼Œä¸æ‹†çµ„åˆ
                if (playCards && last && last.type === 1) {
                    const split = findSplitSingleOver(current, last.value);
                    // åªç”¨æ•£ç‰Œå£“ï¼ˆcounts===1ï¼‰ï¼Œé™¤éé€£æ•£ç‰Œä¹Ÿä¸å¤ å¤§
                    const betterSingle = players[current].filter(c => myCounts[c.rank] === 1 && power[c.rank] > last.value);
                    if (betterSingle.length > 0) playCards = [betterSingle[0]];
                }
            }
            // åœ°ä¸»å¿«è´ï¼ˆ1-2å¼µï¼‰ï¼šç„¡è«–å¦‚ä½•éƒ½è¦å‡º
            if (meDanger && !playCards) playCards = findBestPlay(current);
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ã€è¾²æ°‘ç­–ç•¥ã€‘
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    else {
        // â”€â”€ ç­–ç•¥1ï¼šéšŠå‹ä¸»å°ï¼ˆéšŠå‹æ˜¯ä¸Šå®¶ä¸”å±€å‹¢æ¨‚è§€ï¼‰â†’ è®“ç‰Œ â”€â”€
        if (isTeammateLast && last) {
            const tmCard = last;
            // éšŠå‹å‡ºäº†å¤§ç‰Œï¼ˆK/A/2/ç‚¸å½ˆï¼‰æˆ–éšŠå‹ç‰Œå¾ˆå°‘ â†’ æ”¾è¡Œ
            const tmStrong = tmCard.value >= 13 || tmCard.type === 10 || tmCard.type === 99;
            const tmAlmostWin = tmCount <= 3;
            if (tmStrong || tmAlmostWin) {
                playCards = null; // è®“éšŠå‹é
            }
        }

        // â”€â”€ ç­–ç•¥2ï¼šç²¾æº–ç‚¸å½ˆæ™‚æ©Ÿ â”€â”€
        // æ¢ä»¶ï¼šæœ‰ç‚¸å½ˆ ä¸” (åœ°ä¸»å¿«è´ OR åœ°ä¸»æ˜¯ä¸Šå®¶ä¸”å‡ºäº†å¤§ç‰Œ)
        const shouldBomb = myBombs.length > 0 && (
            llDanger ||
            (isLandlordLast && last && (last.value >= 14 || last.type === 5 || last.type >= 11))
        );
        if (shouldBomb && last && last.type !== 10 && last.type !== 99) {
            playCards = players[current].filter(c => c.rank === myBombs[0]);
        }

        // â”€â”€ ç­–ç•¥3ï¼šæ‹†ç‰Œå£“åˆ¶ â”€â”€
        // åœ°ä¸»å‡ºå–®ç‰Œä½†æˆ‘æ²’æœ‰æ›´å¤§å–®ç‰Œ â†’ å˜—è©¦æ‹†å°å­å‡ºä¸€å¼µ
        if (!playCards && last && last.type === 1 && !findBestPlay(current)) {
            let splitCard = findSplitSingleOver(current, last.value);
            if (splitCard) playCards = splitCard;
        }

        // â”€â”€ ç­–ç•¥4ï¼šè‡ªå·±å¿«è´ â†’ å…¨åŠ›å‡ºç‰Œ â”€â”€
        if (meDanger) {
            playCards = findBestPlay(current);
        }

        // â”€â”€ ç­–ç•¥5ï¼šåœ°ä¸»æ˜¯ä¸Šå®¶å‡ºäº†ä¸­ç­‰ç‰Œï¼ˆéå¤§ç‰Œï¼‰â†’ å˜—è©¦å£“ â”€â”€
        if (!playCards && isLandlordLast && last) {
            playCards = findBestPlay(current);
        }

        // â”€â”€ ä¸€èˆ¬ï¼šå˜—è©¦æ­£å¸¸å‡ºç‰Œ â”€â”€
        if (!playCards) playCards = findBestPlay(current);
    }

    // æœ€çµ‚åŸ·è¡Œ
    if (playCards && playCards.length > 0) {
        let ev = evaluate(playCards);
        if (ev) executePlay(playCards, ev);
        else executePass();
    } else {
        executePass();
    }
}

/* ===== å«ç‰Œ ===== */
function startBidding() {
    currentBid=0; bidIndex=0;
    let starter=Math.floor(Math.random()*3); bidQueue=[starter,(starter+1)%3,(starter+2)%3];
    updateInfo("ğŸ“¢ é–‹å§‹å«åˆ†..."); setTimeout(processBidding, 800);
}

function processBidding() {
    if (bidIndex >= 3) {
        if (currentBid===0) { updateInfo("âš ï¸ ç„¡äººå«åœ°ä¸»ï¼Œé‡æ–°æ´—ç‰Œ..."); setTimeout(initGame, 1500); return; }
        setLandlord(landlord, currentBid); return;
    }
    let p=bidQueue[bidIndex];
    if (p===0) {
        let panel = document.getElementById("controlPanel");
        let oldLabel = panel.querySelector('.bid-label');
        if (!oldLabel) {
            let lbl = document.createElement('div');
            lbl.className = 'bid-label';
            lbl.textContent = 'â€” è«‹é¸æ“‡å«åˆ† â€”';
            panel.insertBefore(lbl, panel.firstChild);
        }
        let b1 = document.getElementById("btnBid1");
        let b2 = document.getElementById("btnBid2");
        let b3 = document.getElementById("btnBid3");
        let bn = document.getElementById("btnNoBid");
        [b1,b2,b3,bn].forEach((b,idx) => { b.classList.add('btn-bid-anim'); });
        b1.style.display = currentBid<1?"inline-block":"none";
        b2.style.display = currentBid<2?"inline-block":"none";
        b3.style.display = currentBid<3?"inline-block":"none";
        bn.style.display = "inline-block";
        updateInfo("ğŸ¯ ä½ çš„å›åˆï¼Œè«‹å«åˆ†...");
    } else {
        let ai=aiNames[p], aiChoice=0;
        // AI å«åˆ†ï¼šä¾æ‰‹ç‰Œçµ„åˆå¼·åº¦åˆ¤æ–·ï¼Œè€ƒæ…®é€£å°/é †å­ç­‰çµ„åˆæ€§
        let handStrength = assessHandStrength(p);
        let bidProb = handStrength > 0.65 ? 0.85 : handStrength > 0.45 ? 0.6 : 0.3;
        if(currentBid<3 && Math.random()<bidProb) aiChoice=currentBid+1;
        if(aiChoice>0){currentBid=aiChoice;landlord=p;updateInfo(`${ai.avatar} ${ai.name} å«äº† ${currentBid} åˆ†`);if(currentBid===3){setTimeout(()=>setLandlord(landlord,3),1200);return;}}
        else{updateInfo(`${ai.avatar} ${ai.name} ä¸å«`);}
        bidIndex++; setTimeout(processBidding, 1200);
    }
}

/* â”€â”€â”€ ã€å‡ç´šã€‘æ‰‹ç‰Œå¼·åº¦è©•ä¼° â€” è€ƒæ…®çµ„åˆæ€§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   è¨ˆç®—ã€Œå‡ºå®Œæ‰‹ç‰Œæ‰€éœ€å›åˆæ•¸ã€ï¼Œå›åˆæ•¸è¶Šå°‘ä»£è¡¨ç‰Œè¶Šå¼·
   åŒæ™‚åŠ è¨ˆå¤§ç‰Œçå‹µï¼ˆç‚¸å½ˆ/ç«ç®­/2ï¼‰
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function assessHandStrength(playerIdx) {
    const hand = players[playerIdx];
    let score = 0;
    const counts = {};
    hand.forEach(c => counts[c.rank] = (counts[c.rank]||0)+1);

    // å¤§ç‰Œçå‹µ
    const bombCount   = Object.values(counts).filter(v => v >= 4).length;
    const hasRocket   = counts["BJ"] && counts["RJ"];
    const has2        = (counts["2"] || 0) > 0;
    const hasA        = (counts["A"] || 0) > 0;
    const trCount     = Object.values(counts).filter(v => v >= 3).length;
    const pairCount   = Object.values(counts).filter(v => v >= 2).length;

    // é€£å°/é †å­çµ„åˆçå‹µ
    const pairRanks = Object.keys(counts).filter(k => counts[k] >= 2 && power[k] < 15).sort((a,b)=>power[a]-power[b]);
    let consecPairs = 0, maxConsec = 0, cur = 1;
    for (let i = 1; i < pairRanks.length; i++) {
        if (power[pairRanks[i]] === power[pairRanks[i-1]]+1) { cur++; maxConsec = Math.max(maxConsec, cur); }
        else cur = 1;
    }
    const hasBigSeqPairs = maxConsec >= 3; // é€£å°3çµ„ä»¥ä¸Š

    score += bombCount * 0.38;
    score += hasRocket ? 0.35 : 0;
    score += has2 ? 0.14 : 0;
    score += hasA ? 0.09 : 0;
    score += trCount * 0.06;
    score += pairCount * 0.04;
    score += hasBigSeqPairs ? 0.1 : 0;

    return Math.min(score, 1);
}

function playerBid(score) {
    document.querySelectorAll('.btn-bid, #btnNoBid').forEach(b => b.style.display='none');
    let lbl = document.getElementById("controlPanel").querySelector('.bid-label');
    if (lbl) lbl.remove();
    if (score>0){currentBid=score;landlord=0;updateInfo(`ğŸ™‹ ä½ å«äº† ${score} åˆ†`);}else{updateInfo("ä½ é¸æ“‡ä¸å«");}
    bidIndex++; if(currentBid===3){setTimeout(()=>setLandlord(landlord,3),1000);return;}setTimeout(processBidding,1000);
}

function showLandlordAnnounce(name, isPlayer) {
    let overlay = document.createElement('div');
    overlay.className = 'landlord-announce';
    overlay.innerHTML = `
        <div class="landlord-announce-bg"></div>
        <div class="landlord-announce-text">ğŸ‘‘ åœ°ä¸»</div>
        <div class="landlord-announce-sub">${name} æ“”ä»»åœ°ä¸»</div>
    `;
    document.body.appendChild(overlay);
    setTimeout(() => overlay.remove(), 1900);
}

function updatePlayerRoleBadge() {
    let badge = document.getElementById("playerRoleBadge");
    if (!badge || landlord === -1) return;
    if (landlord === 0) {
        badge.textContent = "ğŸ§‘â€ğŸŒ¾ åœ°ä¸»";
        badge.className = "player-role-badge landlord";
    } else {
        badge.textContent = "ğŸŒ¾ è¾²æ°‘";
        badge.className = "player-role-badge farmer";
    }
}

function setLandlord(idx, score) {
    landlord=idx; baseScore=score; current=landlord; lastPlayer=landlord;
    landlordPlayCount=0; farmerPlayCount=0; gameMultiplier=1; updateMultiplierUI();
    players[landlord].push(...holeCards); players[landlord].sort((a,b)=>power[b.rank]-power[a.rank]);
    renderHoleCards(true); renderPlayer(); renderOpponents();
    let name = idx===0 ? "ä½ " : `${aiNames[idx].avatar} ${aiNames[idx].name}`;
    updateInfo(`ğŸ‘‘ ${name} æ“”ä»»åœ°ä¸»ï¼ˆåº•åˆ† ${score}ï¼‰`);
    showLandlordAnnounce(name, idx===0);
    updatePlayerRoleBadge();
    let lbl = document.getElementById("controlPanel").querySelector('.bid-label');
    if (lbl) lbl.remove();
    document.getElementById("btnPlay").style.display="inline-block";
    document.getElementById("btnPass").style.display="inline-block";
    document.getElementById("btnHint").style.display="inline-block";
    if(current!==0) setTimeout(aiPlay,2000); else checkPlayerHasPlay();
}

/* ===== å½©å¸¶ ===== */
function shootConfetti() {
    const container=document.getElementById('confetti-container');
    if(!container)return;
    container.innerHTML=''; container.style.display='block';
    const colors=['#f0c040','#dc2626','#4ade80','#3b82f6','#a855f7','#ff80ab','#ffffff','#fde68a'];
    for(let i=0;i<140;i++){
        let conf=document.createElement('div');
        conf.className='confetti-piece';
        conf.style.left=Math.random()*100+'vw';
        conf.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
        conf.style.animationDuration=(Math.random()*3+2)+'s';
        conf.style.animationDelay=(Math.random()*1.5)+'s';
        conf.style.width=(Math.random()*10+6)+'px';
        conf.style.height=(Math.random()*14+8)+'px';
        conf.style.borderRadius=Math.random()>0.5?'50%':'3px';
        container.appendChild(conf);
    }
    let glow=document.createElement('div');
    glow.className='win-glow';
    document.body.appendChild(glow);
    setTimeout(()=>glow.remove(), 2000);
    setTimeout(()=>{container.style.display='none'; container.innerHTML='';},6000);
}

/* ===== çµç®— ===== */
function endGame(winner) {
    let isLandlordWin=(winner===landlord), playerWon=(winner===0)||(landlord!==0&&winner!==landlord);
    let isSpring=false, springText="";
    if(playerWon){stats.currentWinStreak++;if(stats.currentWinStreak>stats.maxWinStreak)stats.maxWinStreak=stats.currentWinStreak;}
    else{stats.currentWinStreak=0;}
    if(isLandlordWin&&farmerPlayCount===0){isSpring=true;gameMultiplier*=2;springText="ğŸŒ¸ æ˜¥å¤©ï¼";}
    else if(!isLandlordWin&&landlordPlayCount===1){isSpring=true;gameMultiplier*=2;springText="ğŸŒ¸ åæ˜¥å¤©ï¼";}
    let questBonusText="";
    if(playerWon&&questAchievedThisRound){gameMultiplier*=2;questBonusText=`<div style="color:#c084fc;margin-bottom:8px;font-size:13px;">ğŸ¯ ä»»å‹™é”æˆï¼šÃ—2</div>`;}
    questAchievedThisRound=false;
    let finalScore=baseScore*gameMultiplier;
    let modal=document.getElementById("scoreModal");
    let titleEl=document.getElementById("modalTitle");

    if(playerWon){
        titleEl.className="modal-title-win";
        titleEl.innerHTML="ğŸ‰ æ­å–œç²å‹ï¼";
        shootConfetti();
    } else {
        titleEl.className="modal-title-lose";
        titleEl.innerHTML="ğŸ’¥ éºæ†¾è½æ•—";
    }

    let html=`<div style="color:${gameMultiplier>1?'#f0c040':'#aaa'};margin-bottom:10px;font-size:13px;text-align:center;">
        ç¸½å€æ•¸ï¼šÃ—${gameMultiplier} ${springText}
    </div>${questBonusText}`;

    const names=["ä½ ï¼ˆç©å®¶ï¼‰", `${aiNames[1].avatar} ${aiNames[1].name}`, `${aiNames[2].avatar} ${aiNames[2].name}`];
    for(let i=0;i<3;i++){
        let role=i===landlord?"ğŸ§‘â€ğŸŒ¾ åœ°ä¸»":"ğŸŒ¾ è¾²æ°‘";
        let change=isLandlordWin?(i===landlord?finalScore*2:-finalScore):(i===landlord?-finalScore*2:finalScore);
        if(i===0&&playerWon&&stats.currentWinStreak>=3){let bonus=Math.floor(change*0.2);change+=bonus;html+=`<div style="color:#f97316;font-size:12px;text-align:center;margin-bottom:6px;">ğŸ”¥ é€£å‹ç´…åˆ© +${bonus}</div>`;}
        stats.totalScores[i]+=change;
        html+=`<div class="result-row${i===0?' player-row':''}">
            <span>${role} ${names[i]}</span>
            <span class="result-change" style="color:${change>=0?'#4ade80':'#f87171'}">${change>=0?'+'+change:change}</span>
        </div>`;
    }
    /* ã€Bugä¿®å¾©ã€‘localStorage å¯«å…¥åŠ ä¸Š try-catch */
    try { localStorage.setItem("doudizhu_stats", JSON.stringify(stats)); } catch(e) {}
    document.getElementById("modalScores").innerHTML=html;
    modal.style.display="flex";
}

/* ===== ã€Bugä¿®å¾©ã€‘Fisher-Yates æ´—ç‰Œæ¼”ç®—æ³•ï¼Œç¢ºä¿æ¯å±€å…¬å¹³ ===== */
function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

/* ===== åˆå§‹åŒ– ===== */
function initGame() {
    initDailyQuest(); updateStatsUI();
    // é‡ç½®å·²å‡ºç‰Œè¿½è¹¤
    playedCards = {};
    playedBigCards = { "2":0, "A":0, "K":0, "BJ":0, "RJ":0 };
    document.querySelectorAll('.btn-bid, #btnNoBid, #btnPass, #btnPlay, #btnHint').forEach(b=>b.style.display='none');
    document.getElementById("multiplierBadge").style.display="none";
    let badge = document.getElementById("playerRoleBadge");
    if (badge) { badge.textContent=""; badge.className="player-role-badge"; }
    deck=[];
    for(let r of ranks) for(let s of suits) deck.push({rank:r,suit:s,isJoker:false});
    deck.push({rank:"BJ",isJoker:true}); deck.push({rank:"RJ",isJoker:true});
    /* ã€Bugä¿®å¾©ã€‘ä½¿ç”¨ Fisher-Yates å–ä»£ sort(random) */
    shuffleArray(deck);
    holeCards=deck.slice(0,3); players=[[],[],[]];
    for(let i=3;i<54;i++) players[(i-3)%3].push(deck[i]);
    players.forEach(p=>p.sort((a,b)=>power[b.rank]-power[a.rank]));
    renderHoleCards(false); renderPlayer(); renderOpponents(); renderTable([], '', '');
    updateInfo("ğŸ² ç™¼ç‰Œå®Œæˆï¼Œæº–å‚™å«åœ°ä¸»");
    setTimeout(startBidding,800);
}

initGame();

let resizeTimer;
window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => { renderPlayerNoAnim(); }, 150);
});
window.addEventListener('orientationchange', () => {
    setTimeout(() => { renderPlayerNoAnim(); }, 300);
});
</script>
</body>
</html>
